---
title: JARファイルの作成
---

この資料では、以下の内容を説明します。

1. Javaプログラムを配布できる形式にする方法（IntelliJ IDEA使用）
2. JavaDocによるドキュメント生成（IntelliJ IDEA使用）
3. 外部ライブラリの紹介と使用時の注意

## Javaのコンパイル済みプログラムを実行可能形式として作成する

Javaプログラムを配布する場合、`jar`と呼ばれる実行可能形式としてパッケージングする必要があります。

IDEとして使用しているIntelliJ IDEAでは、以下の手順でプロジェクト単位のパッケージング設定が行えます。

### 成果物の設定


1. ツールバーの「File」→「Project Structure」を選択
2. 「Project Structure」ウィンドウが開きますので、次の図を参考に、「Artifacts」を選択、上部「＋」ボタンをクリック、「JAR」→「From modules with dependencies...」を選択
    - ![](/docs/06/SCR-20230427-bezm-2.png)
3. 次の図を参考に、「Main Class」の入力欄右にあるボタンをクリック
    - ![](/docs/06/SCR-20230427-bfps-2.png)
4. mainメソッドを持つクラスが一覧表示されるので、実行させたいメインクラスを選択して「OK」を選択
    - ![](/docs/06/SCR-20230427-bhrm.png)
5. `3.`のときの画面に戻って、先ほど選択したメインクラスが設定されてるかを確認して「OK」を選択
    - ![](/docs/06/SCR-20230427-bhtr.png)
6. 「Project Structure」のウィンドウも「OK」を選択して閉じます

設定は以上です。

### 成果物(jar)ファイルの生成

設定した成果物を生成するには、以下の手順に従います。
***※ 自動では実行されません。jarの提出が求められている場合には、プログラムを提出する直前にこの手順を行ってください。***

1. ツールバーの「Build」→「Build Artifacts...」を選択
    - ![](/docs/06/SCR-20230427-bind-2.png)
2. 次の図のような小さなウィンドウが画面中央に出るので、そのメニューから「Build」を選択
    - ![](/docs/06/SCR-20230427-bitm-2.png)
3. コンパイルエラーもなく、正常にビルドが終わると、次の図のようにプロジェクトフォルダの中の「out」ディレクトリの「artifacts」ディレクトリ内にjarファイルが生成されています。
    - ![](/docs/06/SCR-20230427-bjgc-2.png)


### 成果物を実行して確かめる

プロジェクトディレクトリが、`~/IdeaProjects/JarSample`にあるものとして、ターミナルにて以下のコマンドを実行することで成果物の動作確認が行えます。

```bash
$ cd ~/IdeaProjects/JarSample           # プロジェクトディレクトリに移動
$ cd out/artifacts/JarSample_jar        # Jarの格納場所へ移動
$ java -jar JarSample.jar               # 実行
```

プロジェクトディレクトリは、プロジェクトを新規作成した際に指定したディレクトリです。

動作確認を行ってからファイル提出を行うようにしてください。

----

## 補足資料(JARファイルの生成に関して)
### クラスファイルのパッケージング

Javaのアプリケーションやライブラリをjarファイルにパッケージングするには、`jar`コマンドを使用します。

コマンドのテンプレートは以下のようになっています。

```bash
$ jar オプション jarファイル名 含めるクラスファイル…
```

カレントディレクトリ以下のJavaクラスをすべてsample.jarという名前でパッケージングするには、以下のようにコマンドオプションを指定します。

サンプルソースはmoodleにアップロードしています。

```bash
$ javac jp/ac/ait/oop1/JarSample.java
$ jar -cf JarSample.jar .
```

これでjarファイルの作成は可能です。ライブラリとして他のクラスから参照するだけであればこれで問題はありませんが、このままでは実行可能なjarファイルではありません。

実行可能なjarファイルを作成するには、manifest.mfと呼ばれる設定ファイルが必要です。  
サンプルソースには、それが含まれています。

中身に設定する内容は、以下の様になっています。

```
Manifest-Version: 1.0
Main-Class: jp/ac/ait/oop1/JarSample
```

Main-Classオプションで、jarファイル自体のメインクラスを指定します。

これを、jarコマンドで追加指定してあげることで実行可能形式に変更できます。

```
$ jar -cfm sample.jar manifest.mf .
$ java -jar sample.jar
```

### jarコマンドの主なオプション

| オプション | 概要 |
|----|------------------------|
| -c | 新規にJARファイルを作成
| -u | 既存のJARファイルを更新
| -x | JARファイルの内容を抽出
| -t | JARファイルの内容をリスト表示
| -f | 対象のJARファイルを指定
| -m | MANIFESTファイルを使用してjarファイルの詳細な設定を指定。含めるクラスファイルの中に、MANIFEST.MFというファイルが必要です。**ダブルクリックで実行可能なjarファイルを作るには、このオプションの指定が必須です**

