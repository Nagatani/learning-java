---
title: "拡張forを使った配列要素の取り出し"
sidebar_position: 6
---

# 拡張for (for-each)

## 拡張forとは
配列やコレクションフレームワーク（後の講義でやります）などをforでループさせる場合、どうしても配列インデックスの指定ミスなどが発生してしまいがちです。
これを防ぐために配列やコレクションと呼ばれる複数の要素を持っているものからすべての要素に含まれる値を順に取り出して処理するためのfor文の書き方があります。
Javaでは、これを拡張forと呼びます。
他のプログラミング言語では`for-each`などと呼ばれるものです。


## 書式
```java
for (データ型 変数名: 配列もしくはコレクション){

    //変数名には、配列やコレクションから1件ずつ取り出した要素が入ります。
    //int[3] arr = {1, 2, 3};
    //という配列があり、for (int a : arr) とすると3回ループし、
    //変数aには、1,2,3と順に代入されます。

    //ループは配列やコレクションの要素をすべて取り出し終わるまで繰り返されます。

    //注意点として、このループ中で、大元の配列やコレクションの要素を削除したりすると例外が発生します。
}
```

コロンの後に入る配列もしくはコレクションから要素を順に1つずつ取り出し、変数名の変数へ格納し、要素がすべて取り出されるまで繰り返します。

## 拡張forの使いドコロ
```java
int[] arr = {1, 2, 3};
for (int i = 0; i < 3; i++) {
    System.out.println(arr[i]);
}
```

上記の様な単純に値を取り出すだけが目的の場合には、拡張forの方が良いでしょう。

```java
int[] arr = {1, 2, 3};
for (int a : arr) {
    System.out.println(a);
}
```

と言った様にスッキリとした書き方が可能です。

これは、分解して書くと、以下のような処理内容になっています。

```java
int[] arr = {1, 2, 3};
for (int i = 0; i < arr.length; i++) {
    int a = arr[i];
    System.out.println(a);
}
```

拡張forは、配列の中の要素を順番に取り出すことに関しては優秀ですが、通常のfor構文と違って`int i`の定義がありません。そのため、配列のインデックスを操作して、多重ループを行う場合などには不向きです。

さらに、各変数で取り出した値を代入操作による変更したい場合にも適用できません。
拡張forでは、あくまでもデータの取り出しを行う際に使用すると良いでしょう。

使いドコロをよく考えて計画的に使用しましょう。

また、多次元配列に関して操作を行う場合は、以下のような使い方も可能です。

```java
int[][] arr2 = {
    {1, 2, 3},
    {4, 5, 6},
    {7, 8, 9},
};
for (int[] arr : arr2) {  // 1次元配列を2次元配列から取り出す
    for (int a : arr) {
        System.out.println(a);
    }
}
```

----


## ちょっと先取り - Itarator

***配列操作の場合、手順が複雑化するだけでメリットはほぼない*** のでここではこんなやり方もある程度に見ておきましょう。

Iteratorを使うことで、繰り返し処理のなかで各要素の値を代入操作による変更を行えるなどのメリットがありますが、
配列の場合はIteratorオブジェクトを取り出すためにいったん別オブジェクト（ここではArrayListと呼ばれるListオブジェクト）への変更が必要になるためこのメリットはありません。

次のプログラムを見てください。

```java
// 以下2つのimportを追加してください
// import java.util.Iterator;
// import java.util.Arrays;

String[] stringList = new String[]{ "aaa" , "bbb", "ccc" };
Iterator itr = Arrays.asList(stringList).iterator();  // 一旦ArrayListに変換してそのIteratorを取り出す
while(itr.hasNext()) {
  // 要素をキャストして取り出し(next()メソッドで、次の要素に参照先が変わるので2回目呼ばないように注意しましょう)
  String s = (String)itr.next();
  System.out.println(s);
  s = "This value was changed!!";   // Iteratorの場合はこのような代入が可能
  // ※ただしArrays.asListによって変換後のIterator対して行っているためstringListには一切影響ありません
}
```

このプログラムでは、String型の配列を別オブジェクトであるArrayListに変換してしまっているため、要素の代入による変化は、もとの配列にまったく影響がありません。
現時点ではなんの役に立つのかまったく想像できないと思いますが、後にやるコレクションフレームワークを用いる際には大変有用な方法なので覚えておくと良いでしょう。
